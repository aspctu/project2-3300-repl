<html>

<head>
  <title>3300 Project 2</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>

  <style>
    path.country-outline {
      stroke: #999;
      stroke-width: 1;
    }
  </style>
</head>

<body>
  <svg id="map1" height="620" width="800" style="margin:20px"></svg>
  <script>
    const map1 = d3.select("svg#map1");
    const height = map1.attr("height");
    const width = map1.attr("width");

    async function requestData() {
      // dataset without Antarctica
      const mapData = await d3.json("countries-110m.json");
      console.log(mapData);

      const countries = topojson.feature(mapData, mapData.objects.countries1);
      const countriesMesh = topojson.mesh(mapData, mapData.objects.countries1);

      const proj = d3.geoMercator().fitSize([width, height], countries);
      const path = d3.geoPath().projection(proj);

      console.log(countriesMesh)

      map1.selectAll("path.country").data(countries.features)
        .join("path")
        .attr("class", "country")
        .attr("fill", "#ccc")
        .attr("d", path)

      map1.append("path").datum(countriesMesh)
        .attr("class", "country-outline")
        .attr("d", path)
        .attr("fill", "none");

      const languages = await d3.csv("endangered-languages.csv");
      console.log(languages);

      languages.forEach(d => {
        d.projCoords = proj([d.Longitude, d.Latitude]);
      });

      map1.selectAll("circle.lang").data(languages)
        .join("circle")
        .attr("class", "lang")
        .attr("r", 2)
        .attr("fill", "steelblue")
        .attr("cx", d => d.projCoords[0])
        .attr("cy", d => d.projCoords[1])
    }

    requestData();
  </script>
</body>

</html>